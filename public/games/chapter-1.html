<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ECONS 335 - Chapter 1: Tax of Corporation Earning</title>
  <style>
    /* Minimal reset for iframe context */
    html, body { margin: 0; padding: 0; height: 100%; }
  </style>
</head>
<body>
  <!-- The user's provided HTML is embedded below with the CFO avatar replaced by the scary gif -->
  
  <!-- Start Embedded Game -->
  
  <div id="embedded-game-root"></div>
  <script>
  // Inject the provided HTML markup into the page. This keeps the original structure while allowing small overrides.
  document.getElementById('embedded-game-root').innerHTML = `
  
  <div style="font-family: Arial, sans-serif; min-height:100%;">
  ${String.raw`
  <div class="profit-background" id="profit-background"></div>
  <div class="container">
      <div class="hud">
        <div class="fighter">
          <div class="name">You</div>
          <div class="health"><div id="player-hp" class="health-fill"></div></div>
        </div>
        <div class="versus">VS</div>
        <div class="fighter">
          <div id="opponent-name" class="name">Analyst (AI)</div>
          <div class="health"><div id="ai-hp" class="health-fill enemy"></div></div>
        </div>
        <button class="sound-toggle-inline" id="sound-toggle" onclick="toggleSound()" aria-label="Toggle sound">üîä</button>
      </div>
      <div id="welcome-screen">
          <h1>üëª Haunted Finance Challenge</h1>
          <p style="margin: 30px 0; font-size: 1.4em;">The ghostly CFO is watching your every calculation... üòà</p>
          <p style="margin: 20px 0; font-size: 1.1em;">One wrong answer and your portfolio will suffer her wrath!</p>
          <div style="margin-top:18px;">
            <div style="margin-bottom:10px;font-weight:bold;">Choose your opponent</div>
            <div class="opponents">
              <button class="answer-btn" onclick="selectOpponent('analyst')">Analyst (Easy)</button>
              <button class="answer-btn" onclick="selectOpponent('trader')">Trader (Normal)</button>
              <button class="answer-btn" onclick="selectOpponent('cfo')">CFO Demon (Hard)</button>
            </div>
          </div>
          <button class="start-btn" style="margin-top:18px;" onclick="startPractice()">Enter the Cursed Office üè¢</button>
      </div>
      <div id="practice-screen" class="hidden">
          <h2>üîÆ Learn the Dark Arts of Finance</h2>
          <div class="scenario-box">
              <strong>Cursed Scenario:</strong> You own shares in TechCorp. Each share earns <span style="color: #4ecdc4;">$12.00</span> before the tax demons strike.
              <br>Corporate tax rate: <span style="color: #ffc107;">25%</span>
              <br>Your personal income tax rate: <span style="color: #ff6b6b;">30%</span>
          </div>
          <div class="formula-box">
              <strong>üìú Ancient Formulas of Wealth:</strong><br><br>
              <strong>After Corporate Tax:</strong> Earnings √ó (1 - Corporate Tax Rate)<br>
              ‚Üí $12.00 √ó (1 - 0.25) = $12.00 √ó 0.75 = <span style="color: #4ecdc4;">$9.00</span><br><br>
              <strong>Your Personal Tax:</strong> After-Corporate-Tax √ó Personal Tax Rate<br>
              ‚Üí $9.00 √ó 0.30 = <span style="color: #ff6b6b;">$2.70</span><br><br>
              <strong>Your Final Revenue:</strong> After-Corporate-Tax - Personal Tax<br>
              ‚Üí $9.00 - $2.70 = <span style="color: #4ecdc4;">$6.30</span><br><br>
              <strong>Total Taxes Paid:</strong> Corporate Tax + Personal Tax<br>
              ‚Üí $3.00 + $2.70 = <span style="color: #ffc107;">$5.70</span>
          </div>
          <div class="question">
              <strong>Trial Question:</strong><br>
              The ghostly CFO demands: With the scenario above, what is your final revenue per share?
          </div>
          <div class="answers" id="practice-answers">
              <button class="answer-btn" onclick="handlePracticeAnswer(0)">$5.40</button>
              <button class="answer-btn" onclick="handlePracticeAnswer(1)">$6.30</button>
              <button class="answer-btn" onclick="handlePracticeAnswer(2)">$7.20</button>
              <button class="answer-btn" onclick="handlePracticeAnswer(3)">$8.10</button>
          </div>
          <button class="ready-btn hidden" id="ready-btn" onclick="getReady()">Face the Haunted Challenge! üëª</button>
      </div>
      <div id="countdown-screen" class="hidden">
          <h2>The Ghostly CFO is Preparing Your Doom... üëª</h2>
          <div class="countdown-timer" id="countdown-display">3</div>
      </div>
      <div id="game-screen" class="hidden">
          <div class="timer" id="timer">20</div>
          <div class="score">Cursed Question <span id="current-q">1</span> of <span id="total-q">5</span></div>
          <div class="scenario-box" id="scenario-box"></div>
          <div class="question" id="question"></div>
          <div class="answers" id="answers"></div>
      </div>
      <div id="results-screen" class="hidden">
          <h2>ü¶á The Haunted Session Ends... ü¶á</h2>
          <div style="font-size: 2.5em; margin: 30px 0; color: #4ecdc4;" id="final-score"></div>
          <div style="font-size: 1.3em; margin: 20px 0;" id="performance-message"></div>
          <button class="start-btn" onclick="resetGame()">Dare to Face Her Again? üòà</button>
      </div>
  </div>
  `}
  `
  </script>

  <style>
  *{margin:0;padding:0;box-sizing:border-box}
  body{font-family:'Arial',sans-serif;background:linear-gradient(135deg,#0f0f23 0%,#1a1a2e 50%,#16213e 100%);min-height:100vh;display:flex;justify-content:center;align-items:center;color:white;overflow-x:hidden;position:relative}
  body::before{content:"";position:fixed;inset:0;background:url('/images/financial_manager.gif') center/cover no-repeat;opacity:.08;mix-blend-mode:screen;z-index:0;pointer-events:none}
  .profit-background{position:fixed;top:0;left:0;width:100%;height:100%;z-index:1;opacity:.15;transition:all 1s ease}
  .profit-line{position:absolute;width:100%;height:4px;background:linear-gradient(90deg,transparent,#4ecdc4,transparent);animation:moveProfitLine 4s infinite linear}
  .profit-line.loss{background:linear-gradient(90deg,transparent,#ff4757,transparent);animation:moveLossLine 2s infinite linear}
  @keyframes moveProfitLine{0%{transform:translateX(-100%) translateY(0)}100%{transform:translateX(100%) translateY(-20px)}}
  @keyframes moveLossLine{0%{transform:translateX(-100%) translateY(0)}100%{transform:translateX(100%) translateY(20px)}}
  .container{background:rgba(0,0,0,.72);backdrop-filter:blur(16px);border-radius:20px;padding:28px;max-width:960px;width:92%;text-align:center;box-shadow:0 20px 60px rgba(0,0,0,.5);z-index:10;position:relative;border:2px solid rgba(78,205,196,.25)}
  .timer{font-size:3.2em;font-weight:800;margin-bottom:16px;text-shadow:3px 3px 6px rgba(0,0,0,.7);transition:all .3s ease}
  .timer.warning{color:#ffa726;animation:timerPulse .5s infinite}
  .timer.danger{color:#ff5252;animation:timerShake .3s infinite;text-shadow:0 0 16px #ff5252}
  @keyframes timerPulse{0%,100%{transform:scale(1)}50%{transform:scale(1.12)}}
  @keyframes timerShake{0%,100%{transform:translateX(0) scale(1.02)}25%{transform:translateX(-4px) scale(1.02)}75%{transform:translateX(4px) scale(1.02)}}
  .scenario-box{background:rgba(78,205,196,.1);border:2px solid #4ecdc4;border-radius:12px;padding:18px;margin:18px 0;font-size:1.1em;line-height:1.6}
  .question{font-size:1.5em;margin-bottom:20px;line-height:1.6;background:rgba(255,255,255,.08);padding:20px;border-radius:14px;border-left:6px solid #4ecdc4}
  .answers{display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-bottom:20px}
  .answer-btn{padding:18px 16px;font-size:1.1em;border:none;border-radius:12px;background:rgba(255,255,255,.1);color:white;cursor:pointer;transition:all .2s ease;border:2px solid transparent}
  .answer-btn:hover{background:rgba(255,255,255,.2);transform:translateY(-3px)}
  .answer-btn.correct{background:linear-gradient(135deg,#4ecdc4,#26d0ce);border-color:#26d0ce}
  .answer-btn.incorrect{background:linear-gradient(135deg,#ff4757,#ff3742);border-color:#ff3742}
  .start-btn,.ready-btn{padding:16px 28px;font-size:1.1em;background:linear-gradient(135deg,#4ecdc4 0%,#44a08d 100%);color:white;border:none;border-radius:12px;cursor:pointer;transition:all .2s ease;box-shadow:0 8px 20px rgba(0,0,0,.3);text-transform:uppercase;font-weight:700}
  .start-btn:hover,.ready-btn:hover{transform:translateY(-3px)}
  .score{font-size:1.2em;margin:16px 0;background:rgba(0,0,0,.4);padding:12px 16px;border-radius:16px;display:inline-block;border:2px solid #4ecdc4}
  .hidden{display:none}
  /* HUD and opponent select */
  .hud{display:flex;align-items:center;justify-content:center;gap:18px;margin-bottom:12px;flex-wrap:wrap}
  .fighter{display:flex;align-items:center;gap:8px}
  .name{font-weight:700}
  .health{width:150px;height:12px;background:#222;border:1px solid #555;border-radius:7px;overflow:hidden}
  .health-fill{height:100%;width:100%;background:linear-gradient(90deg,#4ecdc4,#26d0ce)}
  .health-fill.enemy{background:linear-gradient(90deg,#ff6b6b,#ff4757)}
  .versus{font-weight:900;letter-spacing:1px}
  .sound-toggle-inline{margin-left:12px;background:rgba(0,0,0,.6);border:1px solid #4ecdc4;color:#fff;border-radius:50%;padding:6px 8px}
  .opponents{display:flex;gap:10px;flex-wrap:wrap;justify-content:center}
  /* Hit effects */
  @keyframes shake{0%,100%{transform:translateX(0)}20%{transform:translateX(-6px)}40%{transform:translateX(6px)}60%{transform:translateX(-4px)}80%{transform:translateX(4px)}}
  .shake{animation:shake .4s ease}
  </style>

  <script>
  let currentQuestionIndex=0,correctAnswers=0,totalQuestions=5,timer,timeLeft=20,soundEnabled=true,audioContext,balancePercentage=100;let currentScenario={},gameQuestions=[];let playerHp=100,aiHp=100;let opponentMode='analyst';let hasTimer=false;function selectOpponent(t){opponentMode=t;const name=t==='analyst'?'Analyst (AI)':t==='trader'?'Trader (AI)':'CFO Demon (AI)';document.getElementById('opponent-name').textContent=name}
  function generateRandomScenario(){const e=(Math.random()*15+5).toFixed(2),t=Math.floor(20*Math.random()+15),n=Math.floor(25*Math.random()+20),a=e*(1-t/100),o=a*(n/100),r=a-o,c=e*t/100+o;return{earnings:parseFloat(e),corporateTax:t,personalTax:n,afterCorporateTax:parseFloat(a.toFixed(2)),personalTaxAmount:parseFloat(o.toFixed(2)),finalRevenue:parseFloat(r.toFixed(2)),totalTaxes:parseFloat(c.toFixed(2))}}
  function generateQuestion(e){let type='revenue';if(opponentMode==='trader'){type=['revenue','taxes','personal'][Math.floor(Math.random()*3)]}else if(opponentMode==='cfo'){type=['revenue','taxes','personal'][Math.floor(Math.random()*3)]}
    if(type==='revenue'){const t=e.finalRevenue,n=[(t*.8).toFixed(2),(t*1.2).toFixed(2),(t*.9).toFixed(2)].map(s=>parseFloat(s));return{type:'revenue',question:'What is your final revenue per share after all taxes?',correct:e.finalRevenue,answers:shuffleArray([e.finalRevenue,...n]).map(s=>`$${s.toFixed(2)}`)}}
    if(type==='personal'){const t=e.personalTaxAmount,n=[(t*.7).toFixed(2),(t*1.3).toFixed(2),(t*.85).toFixed(2)].map(s=>parseFloat(s));return{type:'personal',question:'How much personal tax is paid per share?',correct:e.personalTaxAmount,answers:shuffleArray([e.personalTaxAmount,...n]).map(s=>`$${s.toFixed(2)}`)}}
    {const t=e.totalTaxes,n=[(t*.7).toFixed(2),(t*1.3).toFixed(2),(t*.85).toFixed(2)].map(s=>parseFloat(s));return{type:'taxes',question:'What is the total amount of taxes paid per share?',correct:e.totalTaxes,answers:shuffleArray([e.totalTaxes,...n]).map(s=>`$${s.toFixed(2)}`)}}}
  function shuffleArray(e){const t=[...e];for(let e=t.length-1;e>0;e--){const n=Math.floor(Math.random()*(e+1));[t[e],t[n]]=[t[n],t[e]]}return t}
  function initAudio(){audioContext||(audioContext=new(window.AudioContext||window.webkitAudioContext))}
  function playSound(e,t,n='sine',a=.1){if(!soundEnabled)return;initAudio();const o=audioContext.createOscillator(),r=audioContext.createGain();o.connect(r),r.connect(audioContext.destination),o.frequency.setValueAtTime(e,audioContext.currentTime),o.type=n,r.gain.setValueAtTime(a,audioContext.currentTime),r.gain.exponentialRampToValueAtTime(.01,audioContext.currentTime+t),o.start(audioContext.currentTime),o.stop(audioContext.currentTime+t)}
  function playScarySound(isCorrect){if(!soundEnabled)return;isCorrect?(playSound(440,.3,'triangle',.12),setTimeout(()=>playSound(660,.2,'sine',.08),150)):(playSound(150,.5,'sawtooth',.12),setTimeout(()=>playSound(100,.25,'square',.08),150))}
  function toggleSound(){soundEnabled=!soundEnabled,document.getElementById('sound-toggle').textContent=soundEnabled?'üîä':'üîá'}
  function updateHud(){document.getElementById('player-hp').style.width=Math.max(0,playerHp)+'%';document.getElementById('ai-hp').style.width=Math.max(0,aiHp)+'%'}
  function startPractice(){document.getElementById('welcome-screen').classList.add('hidden'),document.getElementById('practice-screen').classList.remove('hidden')}
  function handlePracticeAnswer(e){const t=document.querySelectorAll('#practice-answers .answer-btn'),n=1;t.forEach(((t,a)=>{t.disabled=!0,a===n?t.classList.add('correct'):a===e&&e!==n&&t.classList.add('incorrect')})),setTimeout(()=>{document.getElementById('ready-btn').classList.remove('hidden')},900)}
  function getReady(){document.getElementById('practice-screen').classList.add('hidden'),document.getElementById('countdown-screen').classList.remove('hidden');let e=3;const t=document.getElementById('countdown-display'),n=setInterval(()=>{t.textContent=e,e<0&&(clearInterval(n),startGame()),e--},1e3)}
  function startGame(){document.getElementById('countdown-screen').classList.add('hidden'),document.getElementById('game-screen').classList.remove('hidden'),gameQuestions=[];for(let i=0;i<totalQuestions;i++){const s=generateRandomScenario(),q=generateQuestion(s);gameQuestions.push({scenario:s,question:q})}currentQuestionIndex=0,correctAnswers=0,playerHp=100,aiHp=100,updateHud();hasTimer=opponentMode==='cfo';document.getElementById('timer').parentElement.style.display=hasTimer?'block':'none';loadQuestion();if(hasTimer) startTimer()}
  function loadQuestion(){if(currentQuestionIndex>=gameQuestions.length){endGame();return}const{scenario:e,question:t}=gameQuestions[currentQuestionIndex];document.getElementById('current-q').textContent=currentQuestionIndex+1,document.getElementById('total-q').textContent=totalQuestions,document.getElementById('scenario-box').innerHTML=`
                <strong>The CFO's Cursed Scenario:</strong><br>
                Per share earnings (before the tax demons): <span style="color: #4ecdc4;">${e.earnings.toFixed(2)}</span><br>
                Corporate tax curse: <span style=\"color: #ffc107;\">${e.corporateTax}%</span><br>
                Your personal tax burden: <span style=\"color: #ff6b6b;\">${e.personalTax}%</span>
            `,document.getElementById("question").innerHTML = `<strong>${t.question}</strong>`;const n=document.getElementById("answers");n.innerHTML="";const correctLabel=`$${t.correct.toFixed(2)}`;t.answers.forEach((ans=>{const b=document.createElement('button');b.className='answer-btn';b.textContent=ans;b.onclick=(ev)=>handleAnswer(ans===correctLabel, ev.currentTarget);n.appendChild(b)}));timeLeft=hasTimer?40:0,updateTimerDisplay()}function handleAnswer(isCorrect,clickedBtn){const buttons=document.querySelectorAll('#answers .answer-btn');buttons.forEach(btn=>btn.disabled=true);buttons.forEach(btn=>{if(btn.textContent===`$${gameQuestions[currentQuestionIndex].question.correct.toFixed(2)}`){btn.classList.add('correct')}});if(!isCorrect&&clickedBtn){clickedBtn.classList.add('incorrect')}playScarySound(isCorrect);if(isCorrect){correctAnswers++;aiHp=Math.max(0,aiHp-20)}else{playerHp=Math.max(0,playerHp-25);document.querySelector('.container').classList.add('shake');setTimeout(()=>document.querySelector('.container').classList.remove('shake'),400)}updateHud();if(hasTimer) clearInterval(timer);setTimeout(()=>{currentQuestionIndex++;loadQuestion();if(hasTimer && currentQuestionIndex<gameQuestions.length){startTimer()}else if(!hasTimer && currentQuestionIndex<gameQuestions.length){/* no timer */}},900)}function startTimer(){timeLeft=40;updateTimerDisplay();timer=setInterval(()=>{timeLeft--;updateTimerDisplay();if(timeLeft<=0){clearInterval(timer);playerHp=Math.max(0,playerHp-20);updateHud();setTimeout(()=>{currentQuestionIndex++;loadQuestion();if(currentQuestionIndex<gameQuestions.length){startTimer()}},600)}},1000)}function updateTimerDisplay(){const el=document.getElementById('timer');if(!hasTimer){el.textContent='';el.className='timer';return}el.textContent=timeLeft;el.className='timer';if(timeLeft<=3){el.classList.add('danger')}else if(timeLeft<=7){el.classList.add('warning')}}function endGame(){if(hasTimer) clearInterval(timer);document.getElementById('game-screen').classList.add('hidden');document.getElementById('results-screen').classList.remove('hidden');const pct=correctAnswers/totalQuestions*100;document.getElementById('final-score').textContent=`${correctAnswers}/${totalQuestions} Correct (${pct.toFixed(0)}%)`;let msg='';msg=playerHp>aiHp?"üèÜ You outplayed the AI ‚Äî finance champion!":"ü§ñ The AI analyst overwhelmed you ‚Äî study the formulas and try again!";msg+=`<br><br>HP ‚Äî You: ${playerHp}% vs AI: ${aiHp}%`;document.getElementById('performance-message').innerHTML=msg}function resetGame(){if(hasTimer) clearInterval(timer);document.getElementById('results-screen').classList.add('hidden');document.getElementById('welcome-screen').classList.remove('hidden');currentQuestionIndex=0;correctAnswers=0;playerHp=100;aiHp=100;updateHud();document.getElementById('profit-background').innerHTML=''}
  // Inject scary gif into CFO avatar
  window.addEventListener('DOMContentLoaded', () => {
    const avatar = document.querySelector('.cfo-avatar');
    if (avatar) {
      avatar.innerHTML = '<img src="/images/financial_manager.gif" alt="Scary CFO" />' + avatar.innerHTML;
    }
  });
  </script>

</body>
</html>

